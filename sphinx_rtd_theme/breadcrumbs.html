{% set pagename_wsuffix = pagename + page_source_suffix|default('') %}
{% set check_meta = meta is defined and meta is not none %}

<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    {% block mobile_nav %}
      {# MOBILE NAV, TRIGGLES SIDE NAV ON TOGGLE #}
      <li class="wy-nav-top"><a aria-label="top navigation" data-toggle="wy-nav-top" class="fa fa-bars"></a></li>
    {% endblock %}
    {% block breadcrumbs %}
      <li><a href="{{ pathto(master_doc) }}" class="icon icon-home"> {{ project }}</a> &raquo;</li>
      {% for doc in parents %}
        <li><a href="{{ doc.link|e }}">{{ doc.title }}</a> &raquo;</li>
      {% endfor %}
      <li>{{ title }}</li>
    {% endblock %}
    {% block breadcrumbs_aside %}
      <li class="wy-breadcrumbs-aside" data-toggle="rst-versions">
      {% if hasdoc(pagename) %}
        {% set viewedit_pageref = conf_py_path|default("") + pagename_wsuffix %}
        {% if display_github %}
          {% set viewedit_type = 'github' %}
          {% set custom_edit_host = custom_edit_host|default('github.com/') %}
        {% elif display_bitbucket %}
          {% set viewedit_type = 'gitlab' %}
          {% set custom_edit_host = custom_edit_host|default('bitbucket.org/') %}
        {% elif display_gitlab %}
          {% set viewedit_type = 'bitbucket' %}
          {% set custom_edit_host = custom_edit_host|default('gitlab.com/') %}
        {% endif %}

        {% if check_meta and 'custom_edit_url' in meta %}
          {% set viewedit_href = meta['custom_edit_url'] %}
        {% elif custom_edit_url %}
          {% set viewedit_href = custom_edit_url %}
        {% else %}
          {% set viewedit_href = 'https://' + custom_edit_host + slug_user + '/' + slug_repo %}
          {% set viewedit_subref = slug_version + viewedit_pageref %}
          {% if display_bitbucket %}
            {% set viewedit_subref = '/src/' + viewedit_subref %}
          {% endif %}
        {% endif %}

        {% if viewedit_href %}
          {% if check_meta and viewedit_type+'_url' in meta %}
            <a title="{{ _('View source') }}" href="{{ meta[viewedit_type+'_url'] }}"><i class="fa fa-{{ viewedit_type }}"></i></a>
          {% else %}
            <!--<li><a title="{{ _('Repo on '+viewedit_type) }}" href="{{ viewedit_href }}"><i class="fa fa-{{ viewedit_type }}"></i></a></li>-->
            {% if viewedit_type == 'bitbucket' %}
            <a title="{{ _('View source') }}" href="{{ viewedit_href }}{{ viewedit_subref }}"> <i class="fa fa-binoculars"></i></a>
            <a title="{{ _('Edit source') }}" href="{{ viewedit_href }}{{ viewedit_subref }}?mode=edit"> <i class="fa fa-pencil"></i></a>
            {% else %}
            <a title="{{ _('View source') }}" href="{{ viewedit_href }}/blob/{{ viewedit_subref }}"><i class="fa fa-binoculars"></i></a>
            <a title="{{ _('Edit source') }}" href="{{ viewedit_href }}/edit/{{ viewedit_subref }}"><i class="fa fa-pencil"></i></a>
            {% endif %}
          {% endif %}
        {% elif show_source %}
          {% if source_url_prefix %}
            {% set viewedit_ref = source_url_prefix + pagename_wsuffix %}
            {% set viewedit_nofollow = '' %}
          {% elif has_source and sourcename %}
            {% set viewedit_ref = pathto('_sources/' + sourcename, true)|e %}
            {% set viewedit_nofollow = ' rel="nofollow"' %}
          {% endif %}
          {% if viewedit_ref %}
            <a title="{{ _('View page source') }}" href="{{ viewedit_ref }}"{{ viewedit_nofollow }}><i class="fa fa-binoculars"></i></a>
          {% endif %}
        {% endif %}
      {% endif %}

      {% if current_version %}
        <span class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
          {% if versions %}
            <select class="versions" onchange="location = this.value;">
              {% for slug, url in versions %}
                {%- if slug == current_version %}
                  <option value="{{ url }}" selected="selected">{{ slug }}</option>
                {% else %}
                  <option value="{{ url }}">{{ slug }}</option>
                {% endif %}
              {% endfor %}
            {% else %}
              <span class="rst-current-version" data-toggle="rst-current-version">v: {{ current_version }}</span>
            {% endif %}
            </select>
          <span class="downloads">
            {% for type, url in downloads %}
              {%- if type == 'PDF' %}  {%- set dw_icon = "file-pdf-o" %}     {% endif %}
              {%- if type == 'HTML' %} {%- set dw_icon = "file-archive-o" %} {% endif %}
              {%- if type == 'EPUB' %} {%- set dw_icon = "file-text-o" %}    {% endif %}
              <a title="Download {{ type }}" href="{{ url }}"><i class="fa fa-{{ dw_icon }}"></i></a>
            {% endfor %}
          </span>
        </span>
      {% endif %}

      </li>
    {% endblock %}
  </ul>

  <div class="contentinfo">
    <span class="prevnext" role="navigation" aria-label="breadcrumb navigation">
      {% if (theme_prevnext_location in ['top', 'both']) and prev %}
        <a href="{{ prev.link|e }}" class="prevnext float-left" title="{{ prev.title|striptags|e }}" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> {{ _('Previous') }}</a>
      {% endif %}
    </span>
    <div class="contentinfo-content" role="contentinfo">

      {% if check_meta %}
        <p>
          {% if 'author' in meta %}
            <b>author:</b> {{ meta['author'] }}
          {% endif %}
          {% if 'tags' in meta %}
            <b>tags:</b> {{ meta['tags'] }}
          {% endif %}
        </p>
      {% endif %}
    </div>
    <span class="prevnext" role="navigation" aria-label="breadcrumb navigation">
      {% if (theme_prevnext_location in ['top', 'both']) and next %}
        <a href="{{ next.link|e }}" class="prevnext float-right" title="{{ next.title|striptags|e }}" accesskey="n" rel="next">{{ _('Next') }} <span class="fa fa-arrow-circle-right"></span></a>
      {% endif %}
    </span>
  </div>

  <hr/>
</div>
